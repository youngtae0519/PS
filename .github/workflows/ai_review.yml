name: Algorithm Code Review

on:
  push:
    branches:
      - main

jobs:
  review:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          fetch-depth: 2

      - name: Get changed files
        id: files
        run: |
          # 한글 경로 깨짐 방지 설정
          git config core.quotepath false
          FILES=$(git diff --name-only HEAD^ HEAD | grep '\.py' | xargs)
          echo "changed_files=$FILES" >> $GITHUB_OUTPUT

      - name: AI Review
        if: steps.files.outputs.changed_files != ''
        uses: google-github-actions/run-gemini-cli@v0
        with:
          gemini_api_key: ${{ secrets.GEMINI_API_KEY }}
          # 퀄리티를 극대화한 프롬프트
          prompt: |
            너는 알고리즘 문제 해결(PS) 전문가이자 파이썬 마스터야. 
            현재 제출된 파일의 경로(File Path)에는 백준 문제 번호가 포함되어 있어.

            [리뷰 미션]
            1. 파일 경로에서 문제 번호를 파악하고, 해당 문제의 '알고리즘 분류'와 '시간/메모리 제한'을 먼저 언급해줘.
            2. 현재 코드가 해당 문제의 최적 알고리즘(예: DP, 그리디, 스택 등)을 정확히 사용했는지 분석해줘.
            3. 데이터의 범위(N의 크기)를 고려했을 때, 최악의 경우에도 시간 초과(TLE)가 발생하지 않을지 검증해줘.
            4. 더 파이썬다운(Pythonic) 방식이나 효율적인 내장 모듈(heapq, deque 등)의 활용 방안을 추천해줘.
            5. 문제를 풀 때 놓치기 쉬운 예외 상황(Edge Case)을 제시해줘.

            답변은 한국어로 "총평 - 분석 - 개선안 - 반례" 순서로 가독성 있게 작성해줘.
          files: ${{ steps.files.outputs.changed_files }}
